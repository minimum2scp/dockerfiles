#! /bin/sh

set -e

## environment variables
##
## - DEFAULT_LANG
## - DEFAULT_TZ

if [ -n "${DEFAULT_LANG}" ]; then
  sed -i -e "s/LANG=C/LANG=${DEFAULT_LANG}/" /etc/default/locale
  etckeeper commit "set default LANG to ${DEFAULT_LANG}" 1>/dev/null 2>/dev/null
fi

if [ -n "${DEFAULT_TZ}" ]; then
  if [ -e /usr/share/zoneinfo/${DEFAULT_TZ} ]; then
    TZ_FILE=$(readlink -f /usr/share/zoneinfo/${DEFAULT_TZ})
    ln -nsf ${TZ_FILE} /etc/localtime
    if etckeeper unclean 1>/dev/null 2>/dev/null; then
      etckeeper commit "set timezone to ${DEFAULT_TZ}" 1>/dev/null 2>/dev/null
    fi
  fi
fi
