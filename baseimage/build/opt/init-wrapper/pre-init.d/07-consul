#! /bin/bash

##
## environment variables:
##
## - USE_CONSUL: 1, true, yes, on
##

create_post_init (){
  script=/opt/init-wrapper/post-init.d/${0##*/}

  echo "#! /bin/bash" > ${script}
  sh -c "export -p" | grep -E '^export CONSUL_' >> ${script}
  echo "exec /opt/custom-installers/consul/install.sh" >> ${script}

  chmod 755 ${script}
}

case "${USE_CONSUL}" in
  1|[tT][rR][uU][eE]|[yY][eE][sS]|[oO][nN])
    create_post_init;;
esac
