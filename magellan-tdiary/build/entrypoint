#! /usr/bin/env ruby

if ENV['TDIARY_BASIC_AUTH_USERNAME'] && ENV['TDIARY_BASIC_AUTH_PASSWORD']
  require 'webrick/httpauth/htpasswd'
  htpasswd = WEBrick::HTTPAuth::Htpasswd.new('/usr/src/app/.htpasswd')
  htpasswd.set_passwd(nil, ENV['TDIARY_BASIC_AUTH_USERNAME'], ENV['TDIARY_BASIC_AUTH_PASSWORD'])
  htpasswd.flush
end

if !ENV['MYSQL_HOST'] && ENV['DB_PORT_3306_TCP_ADDR']
  ENV['MYSQL_HOST'] = ENV['DB_PORT_3306_TCP_ADDR']
end

if !ENV['MYSQL_PORT'] && ENV['DB_PORT_3306_TCP_PORT']
  ENV['MYSQL_PORT'] = ENV['DB_PORT_3306_TCP_PORT']
end

program = ARGV.shift
exec(program, *ARGV)
